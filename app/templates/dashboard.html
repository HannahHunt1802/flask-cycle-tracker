<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Dashboard{% endblock %}</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <!-- FullCalendar css -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <!-- FullCalendar js must go before dashboard.js -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
</head>
<body>
    <!-- Inject Flask data for calendar events -->
    <script>
        window.user_periods = {{ user_periods|tojson|safe }};
    </script>

    <div id="dashboard" class="dashboard">
        <!-- Flash messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
            <div class="flash {{ category }}">
                {{ message }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <div class="dashboard-background">
            <div class="dashboard-nav">

                <h1>Hello, {{ user.name }}!</h1>

                <!--tabs-->
                <div class="tab-container">
                    <a href="#" data-target="my-cycle-tab" class="tab">My Cycle</a>
                    <a href="#" data-target="calendar-tab" class="tab">Calendar</a>
                    <a href="#" data-target="settings-tab" class="tab">My Account</a>
                    <a href="#" data-target="logout-tab" class="tab">Log Out</a>

                    <!--invisible logout form-->
                    <form method="POST" action="{{ url_for('main.logout') }}" style="display:none;" id="logout-form" novalidate>
                        {{ logout_form.hidden_tag() }}
                    </form>
                </div>

                <!--next event container-->
                <div class="today-container">
                    <h4 class="small-text">{{ cycle_pred.main_event }}</h4>
                    <h2 class="large-text">{{ cycle_pred.main_text }}</h2>
                    <p class="smallest-text">{{ cycle_pred.secondary_text }}</p>

                    <div class="sun-moon-container">
                        <div class="sun">
                            <img src="{{ url_for('static', filename='assets/Centre.png') }}" alt="Sun Center" class="sun-center">
                            <img src="{{ url_for('static', filename='assets/Rays.png') }}" alt="Rays" class="rays">
                        </div>
                        <div class="moon">
                            <img src="{{ url_for('static', filename='assets/Moon.png') }}" alt="Moon">
                        </div>
                    </div>
                </div>
            </div>

            <!-- MY CYCLE TAB -->
            <div id="my-cycle-tab" class="tab-content">
                <div class="open-tab-container">
                    <div class="open-tab-inner">
                        <p>My Cycle content goes here.</p>
                    </div>
                </div>
            </div>

            <!-- CALENDAR TAB -->
            <div id="calendar-tab" class="tab-content">
                <div class="open-tab-container">
                    <div class="open-tab-inner">

                        <h3>Calendar</h3>
                        <div id="calendar-wrapper">
                            <!--calendar container-->
                            <div id="calendar">
                                <!--<button id="log-period-btn" class="btn btn-primary">Log Period</button>-->
                            </div>
                            <!--day info container-->
                            <div id="day-info-panel" class="day-info hidden">
                                <h3 id="day-info-date"></h3>

                                <div id="day-no-event" class="hidden">
                                    <p>No period logged.</p>
                                    <button id="btn-log-period" class="panel-btn">Log Period</button>
                                </div>

                                <div id="day-has-event" class="hidden">
                                    <p>Period logged:</p>
                                    <p><strong>Start:</strong> <span id="event-start"></span></p>
                                    <p><strong>End:</strong> <span id="event-end"></span></p>

                                    <button id="btn-edit-period" class="panel-btn">Edit Period</button>
                                    <button id="btn-delete-period" class="panel-btn delete">Delete Period</button>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <!-- SETTINGS TAB -->
            <div id="settings-tab" class="tab-content">
                <div class="open-tab-container">

                    <div class="open-tab-inner">
                        <h3>My Account</h3>
                        <form method="POST" action="{{ url_for('main.update_profile') }}" novalidate>
                            {{ update_profile_form.hidden_tag() }}

                            <div class="update_profile_form-group">
                                <label for="name">Name:</label>
                                {{ update_profile_form.name(class="form-control", value=user.name) }}
                            </div>

                            <div class="update_profile_form-group">
                                <label for="email">Email:</label>
                                {{ update_profile_form.email(class="form-control", value=user.email) }}
                            </div>

                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </form>
                    </div>
                    <hr>

                    <div class="open-tab-inner">
                        <h3>Change Password</h3>
                        <form method="POST" action="{{ url_for('main.change_password') }}">
                            {{ change_password_form.hidden_tag() }}
                            <div class="form-group">
                                <label for="old_password">Current Password:</label>
                                {{ change_password_form.old_password(class="form-control") }}
                            </div>
                            <div class="form-group">
                                <label for="new_password">New Password:</label>
                                {{ change_password_form.new_password(class="form-control") }}
                            </div>
                            <div class="form-group">
                                <label for="confirm_password">Confirm New Password:</label>
                                {{ change_password_form.confirm_password(class="form-control") }}
                            </div>
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </form>
                    </div>
                    <hr>

                    <div class="open-tab-inner">
                        <h3>Cycle Settings</h3>
                        <form method="POST" action="{{ url_for('main.update_cycle_settings') }}">
                            {{ update_cycle_settings_form.hidden_tag() }}

                            <div class="form-group">
                                <label for="regular_cycle">Regular Cycle?</label>
                                <label class="switch">
                                    {{ update_cycle_settings_form.regular_cycle(class="toggle-input") }}
                                    <span class="slider"></span>
                                </label>
                            </div>

                            <div class="form-group">
                                <label for="avg_period_length">Average Period Length (days):</label>
                                {{ update_cycle_settings_form.avg_period_length(class="form-control") }}
                            </div>

                            <div class="form-group">
                                <label for="avg_cycle_length">Average Cycle Length (days):</label>
                                {{ update_cycle_settings_form.avg_cycle_length(class="form-control") }}
                            </div>

                            <button type="submit" class="btn btn-primary">Update Cycle Settings</button>
                        </form>
                    </div>
                    <hr>

                    <div class="open-tab-inner">
                        <h3>Danger Zone</h3>
                        <form method="POST" action="{{ url_for('main.delete_account') }}" onsubmit="return confirm('Are you sure you want to delete your account? This action cannot be undone.');">
                            {{ delete_account_form.hidden_tag() }}

                            <p class="danger-zone-warning">
                                Deleting your account is irreversible. All your data will be lost.
                            </p>

                            <button type="submit" class="btn btn-danger">Delete Account</button>
                        </form>
                    </div>
                    <hr>

                </div>
            </div>
        </div>
    </div>
</body>
</html>